\documentclass[11pt, fleqn]{article}

\usepackage[letterpaper, margin=0.7in]{geometry}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{cleveref}
\usepackage{listings}
\usepackage{multicol}
\usepackage{tikz}
\usepackage{bm}
\usepackage{minted}
\usetikzlibrary{arrows}
\usepackage{wrapfig}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[section]{placeins}
\usepackage{pgfplots,wrapfig}  
\pgfplotsset{compat=newest} 
\pgfplotsset{plot coordinates/math parser=false} 
\newlength\figureheight 
\newlength\figurewidth 
\setlength{\parindent}{0pt}
\newcommand\tab[1][1cm]{\hspace*{#1}}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}

\raggedbottom

\begin{document}

\begin{center}

\Large{COMP6212 Assignment 2 : Shakib-Bin Hamid 25250094 sh3g12}

\end{center}

\section{Black-Scholes Equation Check Solution Correctness}

\subsection{}
Cumulative normal distribution function, $\mathcal{N}(x) = \frac{1}{\sqrt{2\pi}} \int_x^{-\infty} exp(\frac{-y^2}{2})dy$. $\mathcal{N}'(x) = \frac{1}{\sqrt{2\pi}}exp(\frac{-x^2}{2})$.

\subsection{}
\vspace{-1cm}
\begin{eqnarray*}
&& d_2 = d_1 - \sigma\sqrt{T-t}\\
&\implies& \frac{d_2^2}{2} = \frac{d_1^2}{2} + \frac{\sigma^2(T-t)}{2} - d_1\sigma\sqrt{T-t}\\
&\implies& \frac{d_1^2}{2} - \frac{d_2^2}{2} = d_1\sigma\sqrt{T-t} - \frac{\sigma^2(T-t)}{2} = log(\frac{S}{K}) + r(T-t)\\
&\implies& log(\frac{S}{K}) = \frac{d_1^2}{2} - \frac{d_2^2}{2} - r(T-t)\\
&\implies& \frac{S}{K} = exp(\frac{d_1^2}{2} - \frac{d_2^2}{2} - r(T-t)) = \frac{exp(\frac{-d_2^2}{2})}{exp(\frac{-d_1^2}{2} - r(T-t))} = \frac{\mathcal{N}'(d_2)}{\mathcal{N}'(d_1)exp(r(T-t))}\\
&\implies& S\mathcal{N}'(d_1) = Kexp(-r(T-t))\mathcal{N}'(d_2) 
\end{eqnarray*}

\subsection{}
\vspace{-1cm}
\begin{eqnarray*}
&& d_1 = \frac{log(\frac{S}{K})+(r+\frac{\sigma^2}{2})(T-t)}{\sigma\sqrt{(T-t)}} \\
&\implies& \frac{\partial d_1}{\partial S} = \frac{1}{\sigma\sqrt{(T-t)}} \frac{\partial}{\partial S}(logS - logK + (r+\frac{\sigma^2}{2})(T-t)) = \frac{1}{\sigma S \sqrt{(T-t)}}\\
&Similarly& d_2 = d_1 - \sigma\sqrt{T-t} \implies \frac{\partial d_2}{\partial S} = \frac{\partial d_1}{\partial S}= \frac{1}{\sigma S \sqrt{(T-t)}}
\end{eqnarray*}

\subsection{}
$c = S\mathcal{N}(d_1) - Kexp(-r(T-t))\mathcal{N}(d_2)$

\begin{eqnarray*}
\frac{\partial c}{\partial t} &=& \frac{\partial}{\partial t}[S\mathcal{N}(d_1) - Kexp(-r(T-t))\mathcal{N}(d_2)] \\
&=& S\mathcal{N}'(d_1)\frac{\partial d_1}{\partial t} - Kexp(-r(T-t))[r\mathcal{N}(d_2) + \mathcal{N}'(d_2)\frac{\partial d_2}{\partial t}]\\
&=& S\mathcal{N}'(d_1)\frac{\partial d_1}{\partial t} - Kexp(-r(T-t))[r\mathcal{N}(d_2) + \mathcal{N}'(d_2)(\frac{\partial d_1}{\partial t} + \frac{\sigma}{2\sqrt{T-t}})]\\
&=& [S\mathcal{N}'(d_1) - Kexp(-r(T-t))\mathcal{N}'(d_2)]\frac{\partial d_1}{\partial t} - Kexp(-r(T-t))[r\mathcal{N}(d_2) + \frac{\sigma}{2\sqrt{T-t}}\mathcal{N}'(d_2)]\\
&=& -rKexp(-r(T-t))\mathcal{N}(d_2) - \frac{\sigma}{2\sqrt{T-t}}S\mathcal{N}'(d_1)
\end{eqnarray*}

\begin{eqnarray*}
\frac{\partial c}{\partial S} = \mathcal{N}(d_1) + \frac{1}{\sigma S \sqrt{(T-t)}}[S\mathcal{N}'(d_1) - Kexp(-r(T-t))\mathcal{N}'(d_2)] = \mathcal{N}(d_1)
\end{eqnarray*}

\subsection{}
$
\frac{\partial c}{\partial S} = \mathcal{N}(d_1)
\implies \frac{\partial^2 c}{\partial S^2} = \mathcal{N}'(d_1)\frac{\partial d_1}{\partial S} = \mathcal{N}'(d_1)\frac{1}{\sigma S \sqrt{(T-t)}}
$

\begin{eqnarray*}
\frac{\partial c}{\partial t} &=& -rKexp(-r(T-t))\mathcal{N}(d_2) - \frac{\sigma}{2\sqrt{T-t}}S\mathcal{N}'(d_1) \\
\frac{\sigma^2S^2}{2}\frac{\partial^2 c}{\partial S^2} &=& \mathcal{N}'(d_1)\frac{1}{\sigma S \sqrt{T-t}}\times\frac{\sigma^2S^2}{2} = \frac{\sigma}{2\sqrt{T-t}}S\mathcal{N}'(d_1)\\
rS\frac{\partial c}{\partial S} &=& \mathcal{N}(d_1)rS\\
-rc &=& -r(S\mathcal{N}(d_1) - Kexp(-r(T-t))\mathcal{N}(d_2)) = -rS\mathcal{N}(d_1) + rKexp(-r(T-t))\mathcal{N}(d_2)
\end{eqnarray*}

Adding the above - $\frac{\partial c}{\partial t} + \frac{\sigma^2S^2}{2}\frac{\partial^2 c}{\partial S^2} + rS\frac{\partial c}{\partial S} - rc = 0$. So, Black-Scholes PDE is correct for European call option.

\section{Black-Scholes Option Price vs Actual Option Price}

Black-Scholes equation has a closed form solution, $c = S\mathcal{N}(d_1) - Kexp(-r(T-t))\mathcal{N}(d_2)$, given that the volatility, i.e. Standard Deviation of log returns, $u_i = log(a_i)$ is constant for an asset \cite{hull}. In this formula, interest $r$, time to maturity, $T$, current stock price of the underlying asset, $S$ are constants of the domain. Only, volatility, $\sigma$ needs to be derived from past data. As long as the volatility does not change over time until maturity, the option price will be fair.

\begin{figure}[!h]
\begin{center}
	\resizebox {0.6\textwidth} {!} {\input{q2-prices.tex} }
	\caption{Black-Scholes vs Actual Option Prices}
	\label{fig:q2-prices}
	\vspace{-0.8cm}
\end{center}
\end{figure}

\begin{algorithm}[H]
\caption{Calculating Black-Scholes Option Price}
\label{alg:black-sholes}
\begin{algorithmic}
\State $r = 0.06$ // interest rate
\For {$i \in \{1,...,3T/4\}$} // T = total days = 222
\State $idx = T/4 + i$ // current day
\State $S = stocks(idx)$ // today's stock price
\For {$j \in \{1,...,N\}$} // N = number of options = 10
\State $K = strikePrices(j)$ // strike price of the option
\State $\tau = (dates(T,j)+1 - dates(idx,j))/365$ // maturity time in years
\State $\sigma = std(log(returns(i:T/4+i-1, j)))$ // volatility as SD of log returns
\State $[p, c] = blsprice(S, K, r, \tau, \sigma)$ // matlab function for Black-Scholes price
\If {$isCallOption(j)$}
\State $estPrices(i,j) = c$
\Else
\State $estPrices(i,j) = p$
\EndIf
\EndFor
\EndFor
\end{algorithmic}
\end{algorithm}

Algorithm \ref{alg:black-sholes} describes how I calculated the option prices for the 10 options from $T/4 + 1$ to $T$ days. Then I plotted the estimated option prices against the actual traded prices in Figure \ref{fig:q2-prices}.

\begin{figure}[!h]
   \centering 
   \begin{subfigure}[b]{0.45\textwidth}
     	\resizebox {\textwidth} {!} {\input{q2-error.tex} }
		\label{fig:q2-error}
    \end{subfigure}
    ~
    \begin{subfigure}[b]{0.45\textwidth}
       	\resizebox {\textwidth} {!} {\input{q2-error-boxplot.tex} }
        \label{fig:q2-error-boxplot}
    \end{subfigure}
	\vspace{-0.5cm}
    \caption{Absolute Error between Black-Scholes and Actual Option Prices}
	\label{fig:q2-error-both}
\end{figure}

\begin{wrapfigure}{!h}{0.45\textwidth}
\vspace{-1.5cm}
\begin{center}
	\resizebox {0.4\textwidth} {!} {\input{q2-bls-parameters.tex} }
	\caption{Black-Scholes Parameters}
	\label{fig:q2-bls-parameters}
	\vspace{-1cm}
\end{center}
\end{wrapfigure}

Then I calculated the absolute error between the Black-Scholes option price and the actual traded price. They were plotted in Figure \ref{fig:q2-error-both}. Finally, using Matlab's Financial Toolbox, I calculated the greeks for each option over that period and plotted them in Figure \ref{fig:q2-bls-parameters}.\\

As can be seen from Figure \ref{fig:q2-prices}, the call option prices closely followed the Black-Scholes solution. One exception here is a spike which can also be seen in Figure \ref{fig:q2-error-both} as well where the absolute error was quite substantial compared to other call options.\\

On the other hand, there was a systematic difference between the Black-Scholes formula and actual prices for the put options, seen in both Figure \ref{fig:q2-prices} and \ref{fig:q2-error-both}. All put options were traded at a higher price than that derived from Black-Scholes formula. Thus the absolute errors were also quite large and dispersed.\\

In Figure \ref{fig:q2-bls-parameters}, one of the volatilities has a spike near the end. This is precisely the call option whose price spiked at the same time. This leads me to believe that the price is correlated to the volatility of the underlying asset. Vega, $\nu=\frac{\partial c}{\partial \sigma}$ demonstrates exactly this. Clearly, as time to maturity draws near, the effect steadily goes down to 0. Delta $\Delta=\frac{\partial c}{\partial S}$ is also depicted in the same Figure over the same time period. Note that the horizontal scale is the time from the beginning of observation to the maturity date.




























\begin{thebibliography}{9}
\bibitem{hull} 
J. C. Hull
\textit{Options, Futures and Other Derivatives}. 
Prentice Hall, 2009

\end{thebibliography}

\end{document}











